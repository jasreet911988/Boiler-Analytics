<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/px-view-header/px-view-header.html">
<link rel="import" href="../../bower_components/px-card/px-card.html">
<link rel="import" href="../../bower_components/px-dropdown/px-dropdown.html">
<link rel="import" href="../../bower_components/px-rangepicker/px-rangepicker.html">
<link rel="import" href="../../bower_components/px-vis-timeseries/px-vis-timeseries.html">
<link rel="import" href="../../bower_components/px-vis-xy-chart/px-vis-xy-chart.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/nvd3-elements/nvd3-multi-bar.html">
<link rel="import" href="../../bower_components/nvd3-elements/nvd3-line.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/px-tree/px-tree.html">
<link rel="import" href="../../bower_components/px-popover/px-popover.html">
<link rel="import" href="advisory-view.html">
<!-- <link rel="import" href="../../bower_components/highcharts-chart/highcharts-chart.html"> -->
<!-- <link rel="import" href="temp-view.html"> -->
<!-- <link rel="import" href="pump-performance-view.html"> -->
<dom-module id="overview-view">
<template>
<style is="custom-style" include="iron-flex iron-flex-alignment"></style>
<style>
:host {
display: block;
}

.vertical-text{
  max-width: 8px;
  transform: rotate(270deg);
  transform-origin: left top 0;
  position: relative;
  top: 180px;
}
.warning {
  color: orange;
  list-style-type: disc;
  font-size: 25px;
}
.danger {
  color: red;
  list-style-type: disc;
  font-size: 25px;
}
.kpi{
  width: 20%;
  text-transform: uppercase;

  padding : 20px;
}
.kpiHeader {
  color: white;
  font-size: 14px;
  font-weight: bold;
}
.kpiContent {
  color: white;
  font-size: 18px;
}
.kpiUnits{
  margin-left: 5px;
  font-size: 10px;
  color:white;
  font-weight: bold;
}
.alertListLi {
  list-style-type: disc;
  font-size: 25px;
}
.alertSpan{
  color : white;
  font-weight: bold;
  font-size: 12px;
  position: relative;
  top: -3px;
}
.kpiStatusRed {
  height: 14px;
    margin-right: 5px;
    width: 3px;
    background-color: red;
    display: inline-block;
}
.kpiStatusGreen {
  height: 14px;
    margin-right: 5px;
    width: 3px;
    background-color: red;
    display: inline-block;
}
#dropdownDiv {
max-width: 200px;
}
#row1{
display:flex;
flex-direction:row;
justify-content: space-around;
}
#column1{
display:flex;
flex-direction:column;
}
#column2{
display:flex;
flex-direction:column;
}
.flex-row {
display:flex;
flex-direction:row;
justify-content: space-around;
width : 50%;
}
.flex-col {
display:flex;
flex-direction:column;
min-width: 45%;
margin : 10px;
}
.spanStyle {
font-weight: bolder;
font-size: 20px;
}
.redColor {
color : red;
}
.greenColor {
color : green;
}
.orangeColor {
color : orange;
}
.overview-header{
float:left;
width:200px;
}
.nav {
		background-color: #e2e8ed;
		padding:10px;
		height:30px;
	}
	.nav .right{
		width:93%;
		float:left;
	}
	.nav .left{
		width:7%;
		float:left;
	}
	.search{
		width:40px;
		float:left;
	}
	.user{
		width:40px;
		float:left;
	}
	.highcharts-credits{
	display:none;
	}
.home{
		width:100px;
		float:left;
		vertical-align:middle;
	}
	.alert{
		width:100px;
		float:left;
		vertical-align:middle;
	}
	.performance{
		width:150px;
		float:left;
		vertical-align:middle;
	}
	img {
	vertical-align:middle;
	}
	.home-link {
		text-decoration:none;
	}
	a:visited {
		color: #000;
	}
	.custom-size {
          --iron-icon-width: 25px;
          --iron-icon-height: 25px;
		  color:#000;
        }
		.menutext{
			margin-left:5px;
			position:absolute;
			top:20px;
		}
    .main-content {
      margin: 0px;
      padding: 0px;
      cursor: pointer;
    }
    #close {
       cursor: pointer;
       float:right;
       display:inline-block;
       padding:3px 5px;
       background:#ccc;
       margin-left: 20px;
   }
   .close-button {
     position: relative;
       right: -15px;
       top: -15px;
   }
   .popoverid{
     max-width: 400px;
     --px-popover-max-width: 400px;
     height:250px;
     padding: 0px;
   }
   .alert {
     cursor: pointer;
   }
   #alertCount {
	font-size: 8px;
    border-radius: 50%;
    width: 10px;
    height: 10px;
    padding: 3px;
    top: 15px;
    position: absolute;
	    text-align: center;
    color: #fff;
	background:red;
   }
    .changeBarColor{
        height: 14px;
        margin-right: 5px;
        width: 3px;
        display: inline-block;
    }
</style>
<div class="layout horizontal">

  <div style="width:100%;">
	<div class="nav">
			<div class='right'>
				<div class='home'><a href='/#/boilerAnalytics' on-click="_refresh" class='home-link'><px-icon class="custom-size" icon="px-fea:home"></px-icon><span class='menutext'>Home</span></a></div>
				<div class='alert' on-click="advisoryClicked"><img src='/images/alert.png'>&nbsp;&nbsp;Alert</div>
			</div>
		</div>

    <div id="advsioryElement" style="position:absolute; top:-10px; right:950px; width:500px; "></div>
    <px-popover class="popoverid" id = "pop" for="advsioryElement" orientation="bottom" style="left: 0px" enhanced>

      <span id="close" class="close-button" on-click="close">x</span>

          <div id="column2" class = "main-content">

            <template is="dom-if" if="{{!showFlow}}">
          <p id="para" class="pump-name">Carbon Emmission higher than limit</p>
            </template>
            <template is="dom-if" if="{{!showSpeed}}">
          <p id="para" class="pump-name">Carbon Emmission higher than limit</p>
            </template>
            <template is="dom-if" if="{{showSpeed}}">
          <p id="para" class="pump-name">Carbon Emmission higher than limit</p>
            </template>
            <template is="dom-if" if="{{!showPressure}}">
          <p id="para" class="pump-name">Carbon Emmission higher than limit</p>
            </template>
            <template is="dom-if" if="{{showPressure}}">
          <p id="para" class="pump-name">Carbon Emmission higher than limit</p>
            </template>
<p id="noAlerts" class="pump-name-no">No Alerts</p>
          </div>

         <!-- <armstrong-asset-list datapoints="{{assetList}}"></armstrong-asset-list> -->
    </px-popover>


    <px-card id="tempCardId" style="padding:0px;">
      <template is="dom-if" if="{{kpiObject}}">
        <div style="display:flex; flex-direction: row; width: 100%; background-color: #1b2a33;">
        <div style="width:30%;color:white; border-right: 1px solid white;">
          <div style="overflow-wrap: break-word; padding:20px;">
            <span style="font-weight:bold;text-align:center;text-transform:uppercase;">{{assetName}}</span>
          </div>
          <div>
          <img src="../../images/coal-boiler1.jpg" style="width:80px; height:100px; padding-left: 20px;">
        </div>
          <hr>
          <div style=" display: flex; flex-direction: row;">
        <div>
          <span style="padding:10px;font-size:12px;color:darkgrey;">UPCOMING SERVICE</span><br>
          <span style="padding:10px;font-weight:bold;">Oct 31, 2017</span>
        </div>
        <div>
          <span style="padding:10px;font-size:12px;color:darkgrey;">INSTALLATION DATE</span><br>
          <span style="padding:10px;font-weight:bold;">Mar 29, 2017</span>
        </div>
        </div>
        </div>
        <div style="width:30%;">
          <div class="layout horizontal center-center">
            <div class="kpi" style="width:50%;border-bottom:1px solid #9bacb6;border-right:1px solid #9bacb6;">
            <span class="kpiHeader">Current</span><br>
            <template is="dom-if" if="{{checkForGreen(assetName)}}">
                <span class="changeBarColor" style="background-color: green"></span>
              </template>
              <template is="dom-if" if="{{checkForRed(assetName)}}">
                <span class="changeBarColor" style="background-color: red"></span>
              </template>
            <span class="kpiContent">{{kpiObject.Current}}</span><span class="kpiUnits"></span>
          </div>
          <div class="kpi" style="width:50%;border-bottom:1px solid #9bacb6;border-right:1px solid #9bacb6;">
            <span class="kpiHeader">Coal</span><br>
            <template is="dom-if" if="{{checkForGreen(assetName)}}">
                <span class="changeBarColor" style="background-color: green"></span>
              </template>
              <template is="dom-if" if="{{checkForRed(assetName)}}">
                  <span class="changeBarColor" style="background-color: red"></span>
              </template>
            <span class="kpiContent">{{kpiObject.Speed}}</span><span class="kpiUnits"></span>
          </div>
          </div>
          <div class="layout horizontal center-center">
            <div class="kpi" style="width:65%;border-bottom:1px solid #9bacb6;border-right:1px solid #9bacb6;">
            <span class="kpiHeader">Water</span><br>
              <template is="dom-if" if="{{checkForGreen(assetName)}}">
                  <span class="changeBarColor" style="background-color: green"></span>
              </template>
              <template is="dom-if" if="{{checkForRed(assetName)}}">
                  <span class="changeBarColor" style="background-color: red"></span>
              </template>
            <span class="kpiContent">{{kpiObject.Flow}}</span><span class="kpiUnits"></span>
            </div>
          <div class="kpi" style="width:35%;border-bottom:1px solid #9bacb6;border-right:1px solid #9bacb6;">
            <span class="kpiHeader">Efficiency</span><br>
           <template is="dom-if" if="{{checkForGreen(assetName)}}">
               <span class="changeBarColor" style="background-color: green"></span>
              </template>
              <template is="dom-if" if="{{checkForRed(assetName)}}">
                  <span class="changeBarColor" style="background-color: red"></span>
              </template>
          <span class="kpiContent">{{kpiObject.Power}}</span><span class="kpiUnits"></span>
          </div>
          </div>
          <div class="layout horizontal center-center">
            <div class="kpi" style="width:100%;border-right:1px solid #9bacb6;">
            <span class="kpiHeader">Discharge Carbon Emissions </span><br>
            <template is="dom-if" if="{{checkForGreen(assetName)}}">
                <span class="changeBarColor" style="background-color: green"></span>
              </template>
              <template is="dom-if" if="{{checkForRed(assetName)}}">
                  <span class="changeBarColor" style="background-color: red"></span>
              </template>
            <span class="kpiContent">{{kpiObject.Pressure}}</span><span class="kpiUnits"></span>

          </div>
          </div>

        </div>
        <div style="width:40%;">
          <div>
            <span style="padding:20px;font-size:12px;font-weight:bold;text-transform:uppercase;display:block; color:white;">Advisories</span>
            <hr style="margin:0px;">
			 <px-tree style="color: white;" 
			 keys='{"id":"label","label":"label","children":"items","icon":"icon"}' 
			 items='[{"label":"Sudden increase in carbon emissions" },
			 {"label":"Possibility of low oxygen level"},
			 {"label":"Possibility of high water pressure"},
			 {"label":"Check Coal Quality"},
			 {"label":"Possibility of current unbalance"},
			 {"label":"Sudden Speed decreased Check the governor system"}]'>
             </px-tree>

            <!--ul>
              <template is="dom-repeat" items="{{alertList}}">
                <li class="alertListLi" class$="{{item.status}}"><span class="alertSpan">{{item.message}}</span></li>
              </template>
              < <li class="alertListLi" style="color: orange;"><span class="alertSpan">Check Pump operation (Pump may tend to cavitate). </span></li>
              <li class="alertListLi" style="color: red;"><span class="alertSpan" >Check the pump discharge pressure.</span></li>
              <li class="alertListLi" style="color: orange;"><span class="alertSpan" >High motor temperature</span></li> -->
          <!--/ul-->

          <!--px-tree keys='{"id" : "id", "label" : "label", "children" : "children", "icon" : "icon"}'
                                  items='[{"label":"Leaf 0.0","id":"leaf-0-0"},{"label":"Leaf 0.1","id":"leaf-0-1"},{"label":"Leaf 0.2","id":"leaf-0-2"},{"label":"Branch 0.3","id":"branch-0-3","children":[{"label":"Leaf 1.0","id":"leaf-1-0"},{"label":"Branch 1.1","id":"branch-1-1","children":[{"label":"Leaf 2.0","id":"leaf-2-0"},{"label":"Leaf 2.1","id":"leaf-2-1"},{"label":"Leaf 2.2","id":"leaf-2-2"},{"label":"Leaf 2.3","id":"leaf-2-3"}]},{"label":"Leaf 1.2","id":"leaf-1-2"},{"label":"Branch 1.3","id":"branch-1-3","children":[{"label":"Leaf 2.0","id":"leaf-2-0"},{"label":"Leaf 2.1","id":"leaf-2-1"},{"label":"Leaf 2.2","id":"leaf-2-2"},{"label":"Leaf 2.3","id":"leaf-2-3"},{"label":"Leaf 2.4","id":"leaf-2-4"},{"label":"Leaf 2.5","id":"leaf-2-5"},{"label":"Leaf 2.6","id":"leaf-2-6"},{"label":"Leaf 2.7","id":"leaf-2-7"},{"label":"Leaf 2.8","id":"leaf-2-8"}]},{"label":"Leaf 1.4","id":"leaf-1-4"},{"label":"Leaf 1.5","id":"leaf-1-5"},{"label":"Branch 1.6","id":"branch-1-6","children":[{"label":"Leaf 2.0","id":"leaf-2-0"},{"label":"Leaf 2.1","id":"leaf-2-1"},{"label":"Leaf 2.2","id":"leaf-2-2"},{"label":"Leaf 2.3","id":"leaf-2-3"},{"label":"Leaf 2.4","id":"leaf-2-4"},{"label":"Leaf 2.5","id":"leaf-2-5"},{"label":"Leaf 2.6","id":"leaf-2-6"},{"label":"Leaf 2.7","id":"leaf-2-7"},{"label":"Leaf 2.8","id":"leaf-2-8"},{"label":"Leaf 2.9","id":"leaf-2-9"}]}]},{"label":"Branch 0.4","id":"branch-0-4","children":[{"label":"Leaf 1.0","id":"leaf-1-0"},{"label":"Leaf 1.1","id":"leaf-1-1"},{"label":"Leaf 1.2","id":"leaf-1-2"},{"label":"Leaf 1.3","id":"leaf-1-3"},{"label":"Leaf 1.4","id":"leaf-1-4"},{"label":"Leaf 1.5","id":"leaf-1-5"},{"label":"Leaf 1.6","id":"leaf-1-6"},{"label":"Leaf 1.7","id":"leaf-1-7"},{"label":"Leaf 1.8","id":"leaf-1-8"}]},{"label":"Leaf 0.5","id":"leaf-0-5"},{"label":"Branch 0.6","id":"branch-0-6","children":[{"label":"Leaf 1.0","id":"leaf-1-0"},{"label":"Leaf 1.1","id":"leaf-1-1"},{"label":"Leaf 1.2","id":"leaf-1-2"},{"label":"Leaf 1.3","id":"leaf-1-3"},{"label":"Leaf 1.4","id":"leaf-1-4"},{"label":"Leaf 1.5","id":"leaf-1-5"}]},{"label":"Branch 0.7","id":"branch-0-7","children":[{"label":"Leaf 1.0","id":"leaf-1-0"},{"label":"Leaf 1.1","id":"leaf-1-1"},{"label":"Leaf 1.2","id":"leaf-1-2"},{"label":"Leaf 1.3","id":"leaf-1-3"},{"label":"Leaf 1.4","id":"leaf-1-4"},{"label":"Leaf 1.5","id":"leaf-1-5"}]},{"label":"Leaf 0.8","id":"leaf-0-8"}]'>
          </px-tree-->
          </div>
        </div>

    </div>
      </template>
    </px-card>
    <px-card id="overviewCard" header-text="Load Profile" chevron>
      <!-- <div id="row1"> -->
        <div id="column1" style="">
          <div class="layout horizontal">
          <div>
            <px-rangepicker id="loadProfileRangeId" range="{{selectedRange}}">
          </px-rangepicker>
          </div>
          <div id="dropdownDiv" style="margin-left:20px;">
            <px-dropdown
              id="dayWeekId"
              display-value="day">
              <px-dropdown-content
                extend-dropdown='true'
                extend-dropdown-by='25'
                max-cont-character-width='10'
                items='[{"key":"week","val":"week"},{"key":"day","val":"day"}]'>
              </px-dropdown-content>
            </px-dropdown>
          </div>
          </div>
          <!-- <nvd3-line
          id="lineLoad"
          data="{{LoadData}}"
          height="300"
          width="400"
          use-interactive-guideline>
          </nvd3-line> -->
          <px-vis-timeseries
          debounce-resize-timing="250"
          width="700"
          height="290.5"
          chart-horizontal-alignment="center"
          chart-vertical-alignment="center"
          margin='{"top":20,"bottom":35,"left":65,"right":90}'
          tooltip-config='{}'
          register-config='{"type":"horizontal"}'
          selection-type="xy"
          chart-data='{{LoadData}}'
          series-config='{"y0":{"name":"Water","x":"x","y":"y","yAxisUnit":"usgpm","axis":{"id":"axis1","side":"left","number":"1"}}}'
          chart-extents='{"x":["dynamic","dynamic"],"y":["dynamic","dynamic"]}'
          threshold-data='[{"for":"y","type":"max","value":850},{"for":"y","type":"min","value":500}]'
          display-threshold-title
          threshold-config='{"max":{"color":"red","dashPattern":"5,0","title":"","showThresholdBox":false,"displayTitle":false},
          "min":{"color":"red","dashPattern":"5,0","title":"","showThresholdBox":false,"displayTitle":false}}'
          x-axis-config='{"title":"Date"}'
          y-axis-config='{"title":"Single","titleTruncation":false,"unit":"F","axis1":{"title":"Water","titleTruncation":false,"unit":"usgpm"}}'navigator-config='{"xAxisConfig":{"tickFormat":"%b %d"}}'>
        </px-vis-timeseries>

        <!--  event-data='[{"id":"123","time":1498938000000,"label":"Alert"}]'
          event-config='{"Alert":{"color":"blue","icon":"px-fea:deployments","type":"fa","offset":[0,0],"lineColor":"red","lineWeight":2}}'-->
        </div>
      </px-card>
      <px-card id="overviewCard" header-text="Monthly Energy Consumption" chevron>
        <div id="column2" >
          <px-rangepicker id="energyRangeId" range="{{energySelectedRange}}">
          </px-rangepicker>
          <div id="container1" style="min-width: 700px; height: 400px; margin: 0 auto"></div>
          <!-- <div class="layout horizontal">
            <div class="vertical-text">
              Energy Consumption
            </div>
            <div>
              <nvd3-multi-bar
                        data="{{data}}"
                        height="300"
                        width="400"
                        >
                        </nvd3-multi-bar>
              <highcharts-chart style="width:600px;height:400px;"
              type="spline"
              data='{{barData}}'
              title='Test-Spline Chart'
              x-zoom
              x-label="Iterations"
              y-label="Awesomeness Index"></highcharts-chart>
            </div>
          </div> -->

        </div>
      <!-- </div> -->
    </px-card>
    <!-- new card starts-->
    <px-card id="secondCard" header-text="Carbon Emissions" chevron>
        <div id="column1" style="padding-right:10px;">
          <div class="layout horizontal">
            <div>
              <px-rangepicker id="gravityRangeId" range="{{selectedGravityRange}}">
              </px-rangepicker>
            </div>
            <div id="gravityDropdownDiv" style="max-width:200px;margin-left:20px;">
            <px-dropdown
              id="gravityDropdownId"
              display-value="X">
              <px-dropdown-content
                extend-dropdown='true'
                extend-dropdown-by='25'
                max-cont-character-width='10'
                items='[{"key":"GravityX","val":"X"},{"key":"GravityY","val":"Y"},{"key":"GravityZ","val":"Z"}]'>
              </px-dropdown-content>
            </px-dropdown>
          </div>
          </div>
          <!-- <nvd3-line
          id="gravityGraphId"
          data="{{gravityData}}"
          height="300"
          width="400"
          use-interactive-guideline>
          </nvd3-line> -->
          <px-vis-timeseries
          debounce-resize-timing="250"
          width="700"
          height="290.5"
          chart-horizontal-alignment="center"
          chart-vertical-alignment="center"
          margin='{"top":20,"bottom":35,"left":65,"right":65}'
          tooltip-config='{}'
          register-config='{"type":"horizontal"}'
          selection-type="xy"
          chart-data='{{gravityData}}'
          series-config='{"y0":{"name":"Carbon Emissions","x":"timeStamp","y":"y0","yAxisUnit":"mm/s2","axis":{"id":"axis1","side":"left","number":"2"}}}'
          chart-extents='{"x":["dynamic","dynamic"],"y":["dynamic","dynamic"]}'
          threshold-data='[{"for":"y0","type":"max","value":0.1}]'
          display-threshold-title
          threshold-config='{"max":{"color":"red","dashPattern":"5,0","title":"","showThresholdBox":false,"displayTitle":false}}'
          x-axis-config='{"title":"Date"}'
          y-axis-config='{"title":"Single","titleTruncation":false,"unit":"F","axis1":{"title":"Carbon Emissions","titleTruncation":false,"unit":"mm/s2"}}'navigator-config='{"xAxisConfig":{"tickFormat":"%b %d"}}'>
        </px-vis-timeseries>
        </div>
      </px-card>
      <px-card id="secondCard" header-text="Water & Coal" chevron>
        <div id="column2" >
          <h3></h3>
          <px-rangepicker id="flowspeedRangeId" range="{{flowspeedSelectedRange}}">
          </px-rangepicker>
          <px-vis-timeseries
          debounce-resize-timing="250"
          width="700"
          height="290.5"
          chart-horizontal-alignment="center"
          chart-vertical-alignment="center"
          margin='{"top":20,"bottom":35,"left":65,"right":65}'
          tooltip-config='{}'
          register-config='{"type":"horizontal"}'
          selection-type="xy"
          chart-data='{{flowspeedData}}'
          series-config='{"y0":{"name":"Water","x":"timeStamp","y":"y0","yAxisUnit":"usgpm","axis":{"id":"axis1","side":"left","number":"1"}},
          "y1":{"name":"Coal","x":"timeStamp","y":"y1","yAxisUnit":"%","axis":{"id":"axis2","side":"right","number":"1"}}}'
          chart-extents='{"x":["dynamic","dynamic"],"y":["dynamic","dynamic"]}'
          threshold-data='[{"for":"y0","type":"max","value":1400},{"for":"y0","type":"min","value":250},{"for":"y1","type":"max","value":98}]'
          display-threshold-title
          threshold-config='{"max":{"color":"red","dashPattern":"5,0","title":"","showThresholdBox":false,"displayTitle":false},
          "min":{"color":"red","dashPattern":"5,0","title":"","showThresholdBox":false,"displayTitle":false}}'
          x-axis-config='{"title":"Date"}'
          y-axis-config='{"title":"Single","titleTruncation":false,"unit":"F","axis1":{"title":"Water","titleTruncation":false,"unit":"usgpm"},"axis2":{"title":"Coal","titleTruncation":false,"unit":"%"}}'
          navigator-config='{"xAxisConfig":{"tickFormat":"%b %d"}}'>
        </px-vis-timeseries>
          <!-- <px-vis-xy-chart
                   debounce-resize-timing="250"
                   width="700"
                   height="311.5"
                   chart-horizontal-alignment="center"
                   chart-vertical-alignment="center"
                   margin='{"top":30,"bottom":60,"left":75,"right":20}'
                   tooltip-config='{"forceDateTimeDisplay":false}'
                   register-config='{"type":"horizontal","forceDateTimeDisplay":false}'
                   selection-type="xy"
                   chart-data="{{flowspeedData}}"
                   series-config='{"firstSerie":{"type":"line","name":"FlowVsSpeed","xAxisUnit":"usgpm","yAxisUnit":"%","x":"x","y":"y","axis":{"id":"axis1","number":1,"side":"left"}}}'
                   chart-extents='{"x":["dynamic","dynamic"],"y":["dynamic","dynamic"]}'
                   x-axis-config='{"title":"Flow","labelPosition":"center","orientation":"bottom"}'
                   y-axis-config='{"title":"Speed","labelPosition":"center","orientation":"left"}'>
                           </px-vis-xy-chart>  -->
        </div>
    </px-card>
   <!--  <canvas id="chart" style="width:400px;height:400px;"></canvas> -->
    <px-card id="CanvasCard" header-text="Boiler Efficiency" chevron>
        <div id="column2" >
          <px-rangepicker id="peRangeId" range="{{peSelectedRange}}">
          </px-rangepicker>
        </div>
		<div id="pumpHighchart" style="min-width: 700px; height: 400px; margin: 0 auto"></div>
        <!-- <px-vis-xy-chart
          debounce-resize-timing="250"
          width="700"
          height="311.5"
          chart-horizontal-alignment="center"
          chart-vertical-alignment="center"
          margin='{"top":30,"bottom":60,"left":75,"right":75}'
          tooltip-config='{"forceDateTimeDisplay":false}'
          register-config='{"type":"horizontal","forceDateTimeDisplay":false}'
          selection-type="xy"
          chart-data="{{effChartData}}"
		  series-config='{"firstSerie":{"type":"scatter","name":"Head Vs Flow","xAxisUnit":"usgpm","yAxisUnit":"ft","x":"flow","y":"head","axis":{"id":"axis1","number":1,"side":"left"}},"secondSerie":{"type":"scatter","name":"Efficiency Vs Flow","xAxisUnit":"usgpm","yAxisUnit":"%","x":"flow","y":"efficiency","axis":{"id":"axis2","number":1,"side":"right"}}}'
          chart-extents='{"x":["dynamic","dynamic"],"y":["dynamic","dynamic"]}'
          x-axis-config='{"title":"Flow","labelPosition":"center","orientation":"bottom"}'
          y-axis-config='{"title":"Y","labelPosition":"center","axis1":{"title":"Head","titleTruncation":false,"unit":"ft"},"axis2":{"title":"Efficiency","titleTruncation":false,"unit":"%"}}'>
        </px-vis-xy-chart>-->
    </px-card>
    <!-- <pump-performance-view></pump-performance-view> -->
    <iron-ajax id="aboutContentAjaxEl"></iron-ajax>
    <iron-ajax id="overviewAjaxEl"></iron-ajax>
    <iron-ajax id="loadProfileAjaxEl"></iron-ajax>
    <iron-ajax id="loadProfileLiveAjaxEl"></iron-ajax>
    <iron-ajax id="gravityAjaxEl"></iron-ajax>
    <iron-ajax id="flowspeedAjaxEl"></iron-ajax>
    <iron-ajax id="pumpEfficiencyAjaxEl"></iron-ajax>
    <iron-ajax id="advisoryAjaxEl"></iron-ajax>
  </div>
</div>
</template>
<script>
Polymer({
  is: 'overview-view',
  properties: {
    selectedRange: {
      type: Object
    },
	<!-- effChartData:{ -->
		<!-- type: Array, -->
		<!-- notify:true, -->
		<!-- reflectToAttribute: true, -->
		<!-- observer:'notifyEffChange' -->
	<!-- } -->
    energySelectedRange: {
      type: Object
    },
    assetName : {
      type : String,
      value : ''
    },
    assetId : {
      type : String,
      value : ''
    },
    LoadData : {
      type : Array
    },
    showFlow: {
      type: Boolean
    },
    showSpeed: {
      type: Boolean
    },
    showPressure: {
      type: Boolean
    },
	showCurrent: {
      type: Boolean
    }
  },
  advisoryClicked: function(){
    document.getElementById('advsioryElement').click();
  },
  close: function(){
    console.log('it comes here');
    document.getElementById('pop').hide();
  },
    checkForGreen: function (assetName) {
        return assetName == 'Gasoline Boiler' || assetName == 'Stoker Lump Boiler';
        //return true;
    },
    checkForRed: function (assetName) {
        return assetName == 'Pulverized Coal Boiler';
    },
  _getDefaultRange: function(months) {
    var from;
    var to;
    /*if(months){
      from = '2017-06-01T03:38:22.242Z';
      to = '2017-06-14T03:38:22.242Z';
    }else{
      from = '2017-06-01T03:38:22.242Z';
      to = '2017-07-14T03:38:22.242Z';
    }*/
    from = moment().subtract(months, 'weeks');
    to = moment();

    return {"from":from.toISOString(),"to":to.toISOString()};
  },
  _refresh: function () {
    window.location.reload(true);
  },
  _getNarrowRange: function(months) {
    var from;
    var to;
    /*if(months){
      from = '2017-06-03T03:38:22.242Z';
      to = '2017-06-03T03:58:22.242Z';
    }else{
      from = '2017-06-03T03:38:22.242Z';
      to = '2017-06-04T03:58:22.242Z';
    }    */
    from = moment().subtract(months, 'minutes');
    to = moment();
    return {"from":from.toISOString(),"to":to.toISOString()};
  },
  _getWideRange: function(months) {
    var from;
    var to;
    /*if(months){
      from = '2017-06-03T03:38:22.242Z';
      to = '2017-06-03T03:58:22.242Z';
    }else{
      from = '2017-06-03T03:38:22.242Z';
      to = '2017-06-04T03:58:22.242Z';
    }    */
    from = moment().subtract(months, 'months');
    to = moment();
    return {"from":from.toISOString(),"to":to.toISOString()};
  },
  _setEnergyTimes: function(){
    this.energyStartTime = new Date(this.energySelectedRange.from).getTime();
    this.energyEndTime = new Date(this.energySelectedRange.to).getTime();
  },
  _setLoadTimes: function(){
    this.loadStartTime = new Date(this.selectedRange.from).getTime();
    this.loadEndTime = new Date(this.selectedRange.to).getTime();
  },
  _setGravityTimes: function(){
    this.gravityStartTime = new Date(this.selectedGravityRange.from).getTime();
    this.gravityEndTime = new Date(this.selectedGravityRange.to).getTime();
  },
  _setFlowspeedTimes: function(){
    this.flowspeedStartTime = new Date(this.flowspeedSelectedRange.from).getTime();
    this.flowspeedEndTime = new Date(this.flowspeedSelectedRange.to).getTime();
  },
  _setPeTimes: function(){
    this.peStartTime = new Date(this.peSelectedRange.from).getTime();
    this.peEndTime = new Date(this.peSelectedRange.to).getTime();
  },
  getClasses: function () {
    var spanStyle = 'spanStyle';
    var tempNum = parseInt(this.kpiObject.Speed, 10);
    if(tempNum < 55){
      spanStyle += ' greenColor';
    }else if (tempNum > 65){
      spanStyle += ' redColor';
    }else {
      spanStyle += ' orangeColor';
    }
    return spanStyle;
  },
  ready: function() {
    //window.location.reload(true);
    var reqData1 = [];
	
//{flow: 582.106, head: 60.628, efficiency: 118.2795782579258}
	this.xyData = [{"id":"123","flow": "650","label":"Forecast"}];
    this.assetName = document.getElementById('contextName').value;
    this.assetId = document.getElementById('contextId').value;
    this.selectedRange = this._getDefaultRange(2);
    this.energySelectedRange = this._getWideRange(4);
    this.selectedGravityRange = this._getDefaultRange(2);
    this.flowspeedSelectedRange = this._getDefaultRange(1);
    this.peSelectedRange = this._getNarrowRange(30);
    this._setLoadTimes();
    this._setEnergyTimes();
    this._setGravityTimes();
    this._setFlowspeedTimes();
    this._setPeTimes();
    this.LoadData = [];
    this.barData = [[0,0],[1,7],[2,1],[3,6],[4,8],[5,6]];
    var monthNames = ["January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
    ];
    var that = this;
    that.effChartData = [];
    that.advisoryChartData = [];
    this.dayWeek = this.$.dayWeekId.displayValue;
    this.gravityVal = 'GravityX';
    this.isLive = false;
    this.$.overviewAjaxEl.url = "/api/v1/monthlyenergyconsumption?tagId="+that.assetId+"&startTime="+this.energyStartTime+"&endTime="+this.energyEndTime;

    this.$.loadProfileAjaxEl.url = "/api/v1/loadprofilegraph?tagId="+that.assetId+"&startTime="+this.loadStartTime+"&endTime="+this.loadEndTime+"&groupType="+this.dayWeek;

    this.$.gravityAjaxEl.url = "/api/v1/gravitygraph?tagId="+that.assetId+"&startTime="+this.gravityStartTime+"&endTime="+this.gravityEndTime+"&vibration="+this.gravityVal;

    this.$.flowspeedAjaxEl.url = "/api/v1/flowspeed?tagId="+that.assetId+"&startTime="+this.flowspeedStartTime+"&endTime="+this.flowspeedEndTime;

    that.$.pumpEfficiencyAjaxEl.url = "/api/v1/pumpefficiency?tagId="+that.assetId+"&startTime="+that.peStartTime+"&endTime="+that.peEndTime;
    that.$.advisoryAjaxEl.url = "/api/v1/predictiveanalytic?tagId="+that.assetId;

    this.$.aboutContentAjaxEl.url = "/api/v1/latestdetails?tagId="+that.assetId;

    this.$.aboutContentAjaxEl.addEventListener('response', function(evt) {

      that.kpiObject = evt.detail.response;
      that.alertList = [];
      that.kpiStatus = {};
      that.showAdvisory = {};
      //that.flowDiffValue;
      //that.speedDiffValue;
      //that.pressureDiffValue;
      that.alertList.push({'status':'warning','message':'Check Pump operation (Pump may tend to cavitate).'});
      that.alertList.push({'status':'danger','message':'Check the pump discharge pressure.'});
      that.alertList.push({'status':'warning','message':'High motor temperature'});
      that.kpiObject.Flow = parseFloat(that.kpiObject.Flow).toFixed(2);
      var flowVal = that.kpiObject.Flow;
      //var flowVal = parseFloat(300);
      var currentVal = parseFloat(that.kpiObject.Current);
      var speedVal = parseFloat(that.kpiObject.Speed);
      //var speedVal = 100;
      //var pressureVal = 2;
      var pressureVal = parseFloat(that.kpiObject.Pressure);
      var powerVal = parseFloat(that.kpiObject.Power);
      var maxFlowVal = 1000;
      var minFlowVal = 220;
      var maxCurrentVal = 20;
      var minCurrentVal = 5;
      var maxSpeedVal = 98;
      var maxPressureValue = 22;
      var minPressureValue = 5;
      var maxPowerValue = 18;
        if(flowVal<800){
        that.alertList.push({'status':'danger','message':'Carbon Emission higher than limit '});
        that.showFlow = false;
        that.kpiStatus.flow = false;
      }/*else if(flowVal > 850 || flowVal < 350){
        that.alertList.push({'status':'warning','message':'Flow requires attention'});
        that.kpiStatus.flow = true;
      }*/else{
      //this.showFlow = true;
      that.showFlow = true;
        that.kpiStatus.flow = true;
      }
      if(currentVal >= 20 || currentVal <= 5){
	  that.showCurrent = false;
        that.kpiStatus.current = false;
      }else{
	  that.showCurrent = true;
        that.kpiStatus.current = true;
      }
      if(speedVal >= 87 || speedVal <= 27){
        if(speedVal >= 87){

        //this.showSpeed = false;
        that.showSpeed = false;
        }
        if(speedVal <= 27){

        //this.showSpeed = true;
        that.showSpeed = true;
        }

        that.kpiStatus.speed = false;
      }else{
        that.kpiStatus.speed = true;
      }
      if(pressureVal >= 22 || pressureVal <= 5){
        if(pressureVal >= 22) {
          //that.pressureDiffValue = pressureVal - 22;

          //this.showPressure = false;
          that.showPressure = false;
        }
        if(pressureVal<=5){
        //  that.pressureDiffValue = 5 - pressureVal;

          //this.showPressure = true;
          that.showPressure = true;
        }
        that.kpiStatus.pressure = false;
      }else{
        that.kpiStatus.pressure = true;
      }
      if(powerVal >= 18){
        that.kpiStatus.power = false;
      }else{
        that.kpiStatus.power = true;
      }
	  var alertCount = 0;

			 // document.getElementById('noAlerts').style.display = 'none';
			  setTimeout(function(){
alertCount = document.querySelectorAll('.pump-name').length;
		  if(alertCount>0){
			  //document.getElementById('alertCount').style.display = 'block';
			  document.getElementById('noAlerts').style.display = 'none';
			  document.getElementById('alertCount').innerHTML = alertCount;
			  }else{
			  document.getElementById('noAlerts').style.display = 'block';
			//  document.getElementById('alertCount').style.display = 'none';
			  }
			  }, 2000);


    });
    this.$.overviewAjaxEl.addEventListener('response', function(evt) {
      var reqData = evt.detail.response;
      /*var i;
      for(i = 0; i < reqData.length; i++){
        reqData[i].x = monthNames[new Date(reqData[i]['x']).getMonth()];
        reqData[i].y = reqData[i]['y'];
      }
      that.data = [{
        "key" : "Energy Consumption",
        "values" : reqData
      }];*/

      Highcharts.chart('container1', {
    chart: {
        type: 'column'
    },
    title: {
        text: ''
    },
    subtitle: {
        text: ''
    },
    xAxis: {
        type: 'category'
    },
    yAxis: {
        title: {
            text: 'Energy Consumption (kW)'
        }

    },
    legend: {
        enabled: false
    },
    plotOptions: {
        series: {
            borderWidth: 0,
            dataLabels: {
                enabled: true,
                format: '{point.y:.2f}kW'
            }
        }
    },

    tooltip: {
        headerFormat: '<span style="font-size:11px"></span>',
        pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}</b>kW <br/>'
    },

    series: [{
        name: 'Months',
        colorByPoint: true,
        data: reqData.data
    }],
    drilldown: {
        series: reqData.drilldown
    },
    credits : {
      enabled : false
    }
});
    });

    this.$.loadProfileAjaxEl.addEventListener('response', function(evt) {
      var reqData1 = evt.detail.response;

      /*var i;
      for(i = 0; i < reqData1.length; i++){
        console.log(reqData1[i]['y']);
        reqData1[i].timeStamp = new Date(reqData1[i]['x']);
        reqData1[i].y0 = reqData1[i]['y'];
      }*/
      that.LoadData = reqData1;
    });

    this.$.loadProfileLiveAjaxEl.addEventListener('response', function(evt) {
      //var reqData1 = evt.detail.response;
      reqData1.push(evt.detail.response);
/*var i;
      for(i = 0; i < reqData1.length; i++){
        reqData1[i].timeStamp = new Date(reqData1[i]['x']);
        reqData1[i].y0 = reqData1[i]['y'];
      }*/
      //reqData1.timeStamp = new Date(reqData1['x']);
      //reqData1.y0 = reqData1['y'];
      //this.LoadData.push(reqData1);
      console.log(reqData1);
      that.LoadData = [];
      that.LoadData = reqData1;
    });
    this.$.gravityAjaxEl.addEventListener('response', function(evt) {
      var reqData1 = evt.detail.response;
      var i;
      for(i = 0; i < reqData1.length; i++){
        reqData1[i].timeStamp = new Date(reqData1[i]['x']);
        reqData1[i].y0 = parseFloat(reqData1[i]['y'].toFixed(4));
      }
      that.gravityData = reqData1;
    });
    this.$.flowspeedAjaxEl.addEventListener('response', function(evt) {
      var reqData1 = evt.detail.response;
      var i;
      for(i = 0; i < reqData1.length; i++){
        reqData1[i].timeStamp = new Date(reqData1[i]['x']);
        reqData1[i].y0 = parseFloat(reqData1[i]['y1'].toFixed(4));
        reqData1[i].y1 = parseFloat(reqData1[i]['y2'].toFixed(4));
      }
      that.flowspeedData = reqData1;
      /*for(i = 0; i < reqData1.length; i++){
        that.xAxisValues[reqData1[i]['x']] = reqData1[i]['x'];
        reqData1[i].y = parseFloat(reqData1[i]['y'].toFixed(4));
      }
      that.flowspeedData = [{
        "key" : "Flow Speed Profile",
        "values" : reqData1
      }];*/
    });
    this.$.pumpEfficiencyAjaxEl.addEventListener('response', function(evt) {
      console.log(evt.detail.response);
      that.effChartData = evt.detail.response;
	  var flow = [];
	  var head = [];
	  var efficiency = [];
		that.effChartData = that.effChartData.sort(function(a, b) {
			return parseFloat(a.flow) - parseFloat(b.flow);
		});
	  for(var i=0;i<that.effChartData.length;i++){
		if(i == that.effChartData.length-1){
			flow.push(that.effChartData[i].flow);
			var hjson = {
                y: that.effChartData[i].head,
                color: '#BF0B23',
                marker:{
                    fillColor:'#BF0B23'
                }
            }
			var ejson = {
                y: that.effChartData[i].efficiency,
                color: '#c10b23',
                marker:{
                    fillColor:'#c10b23'
                }
            }
			head.push(hjson);
			efficiency.push(ejson);
		}else{
			flow.push(that.effChartData[i].flow);
			head.push(that.effChartData[i].head);
			efficiency.push(that.effChartData[i].efficiency);
		}
	  }

	  new Highcharts.chart(that.$.pumpHighchart, {
    chart: {
        type: 'scatter'
    },
    title: {
        text: ''
    },
    xAxis: [{
        categories: flow,
        crosshair: true
    }],
    yAxis: [{ // Primary yAxis
        labels: {
            format: '{value}'
        },
        title: {
            text: 'Coal'
        },
        opposite: true

    }, { // Secondary yAxis
        gridLineWidth: 0,
        title: {
            text: 'Water'
        },
        labels: {
            format: '{value}'
        }

    }],
    tooltip: {
        formatter: function() {
            console.log(this)
            if (this.color == '#434348' || this.color=='#c10b23') {
                return 'Coal: '+this.key + ' usgpm / ' + this.y + ' %';
            } else {
                return 'Water: '+this.key + ' usgpm / ' + this.y + ' ft';
            }
        }
    },
    series: [{
        marker: {
            radius: 5,
            lineColor: 'rgb(93,165,218)',
            fillColor: 'rgb(93,165,218)',
            lineWidth: 0,
            symbol: 'circle'
        },
        name: 'Water',
        yAxis: 1,
        data: head

    }, {
        marker: {
            radius: 5,
            lineColor: 'rgb(250,164,58)',
            fillColor: 'rgb(250,164,58)',
            lineWidth: 0,
            symbol: 'circle'
        },
        name: 'Coal',
        data: efficiency
    }]
});

    });



    this.$.advisoryAjaxEl.addEventListener('response', function(evt) {
      //console.log('advisory response'+evt.detail.response);
      that.advisoryChartData = evt.detail.response.results;
      document.querySelector("px-tree").addEventListener('px-tree-node-tapped', function(evt){
        console.log(evt);
		console.log('current selected item event'+evt.detail.item.label);
        document.getElementById('advisoryId').value = evt.detail.item.label;
		if(!evt.detail.isBranch){
        //if((evt.detail.isBranch && evt.detail.isSelected && evt.detail.isActive) || (!evt.detail.isBranch && evt.detail.isSelected)){
        
		window.history.pushState({}, null, '#/advisory');
		window.dispatchEvent(new CustomEvent('location-changed'));
      }
      });

    });


    this.$.dayWeekId.addEventListener('px-dropdown-value-changed', function(evt) {
      that.dayWeek = evt.detail.key;
      var myVar;
      if(that.dayWeek != 'live'){
        clearInterval(myVar);
        that.$.loadProfileAjaxEl.url = "/api/v1/loadprofilegraph?tagId="+that.assetId+"&startTime="+that.loadStartTime+"&endTime="+that.loadEndTime+"&groupType="+that.dayWeek;
        that.$.loadProfileAjaxEl.generateRequest();
      }else {
        //that.LoadData = [];
        that.$.loadProfileLiveAjaxEl.url = "/api/v1/liveflowdata?tagId="+that.assetId;
        myVar = setInterval(function(){ that.$.loadProfileLiveAjaxEl.generateRequest();}, 30000);
      }

    });
	//this.async(function() {
		//if(typeof this.$.advisioryId!='undefined') {
			/*this.$.advisioryId.addEventListener('px-tree-node-tapped', function(evt) {
				console.log(evt);
				//if(!evt.detail.isBranch) {

					window.location.hash="#/advisory";

				//}
			});
		//}
	//});*/
    this.$.gravityDropdownId.addEventListener('px-dropdown-value-changed', function(evt) {
      that.gravityVal = evt.detail.key;
      that.$.gravityAjaxEl.url = "/api/v1/gravitygraph?tagId="+that.assetId+"&startTime="+that.gravityStartTime+"&endTime="+that.gravityEndTime+"&vibration="+that.gravityVal;
      that.$.gravityAjaxEl.generateRequest();
    });
    this.$.loadProfileRangeId.addEventListener('px-datetime-range-submitted', function(evt) {
      that._setLoadTimes();
      that.$.loadProfileAjaxEl.url = "/api/v1/loadprofilegraph?tagId="+that.assetId+"&startTime="+that.loadStartTime+"&endTime="+that.loadEndTime+"&groupType="+that.dayWeek;
      that.$.loadProfileAjaxEl.generateRequest();
    });
    this.$.energyRangeId.addEventListener('px-datetime-range-submitted', function(evt) {
      that._setEnergyTimes();
      that.$.overviewAjaxEl.url = "/api/v1/monthlyenergyconsumption?tagId="+that.assetId+"&startTime="+that.energyStartTime+"&endTime="+that.energyEndTime;
      that.$.overviewAjaxEl.generateRequest();
    });
    this.$.flowspeedRangeId.addEventListener('px-datetime-range-submitted', function(evt) {
      that._setFlowspeedTimes();
      that.$.flowspeedAjaxEl.url = "/api/v1/flowspeed?tagId="+that.assetId+"&startTime="+that.flowspeedStartTime+"&endTime="+that.flowspeedEndTime;
      that.$.flowspeedAjaxEl.generateRequest();
    });
    this.$.peRangeId.addEventListener('px-datetime-range-submitted', function(evt) {
      that._setPeTimes();
      that.$.pumpEfficiencyAjaxEl.url = "/api/v1/pumpefficiency?tagId="+that.assetId+"&startTime=1508953721000&endTime=1508953721127";
      that.$.pumpEfficiencyAjaxEl.generateRequest();
    });
    this.$.gravityRangeId.addEventListener('px-datetime-range-submitted', function(evt) {
      that._setGravityTimes();
      that.$.gravityAjaxEl.url = "/api/v1/gravitygraph?tagId="+that.assetId+"&startTime="+that.gravityStartTime+"&endTime="+that.gravityEndTime+"&vibration="+that.gravityVal;
      that.$.gravityAjaxEl.generateRequest();
    });
    this.$.aboutContentAjaxEl.generateRequest();
    this.$.overviewAjaxEl.generateRequest();
    this.$.loadProfileAjaxEl.generateRequest();
    this.$.gravityAjaxEl.generateRequest();
    this.$.flowspeedAjaxEl.generateRequest();
    this.$.pumpEfficiencyAjaxEl.generateRequest();
    this.$.advisoryAjaxEl.generateRequest();
  }
});

</script>
</dom-module>
